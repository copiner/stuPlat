<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>探究详情</title>
    <script src="./lib/jquery.min.js"></script>
    <style>
        body {
            /* 设置背景颜色为淡蓝色 */
            background-color: #e0f7fa;
        }

        .btn{
            color: #0097a7;
            display: inline-block;
            width: 60px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            cursor: pointer;
            padding: 0 8px;
            border: 1px solid #0097a7;
        }
        .btn:hover{
            background-color: #0097a7;
            color: #ffffff;
        }
        .message{
            height: 30px;
            line-height: 30px;
            width: 240px;
            text-align: center;
            color: red;
        }
        .message-box{
            color: #0097a7;
            display: flex;
            margin-bottom: 20px;
            justify-content: space-between;
        }

        .deatil-container {
            background-color: #fff;
            width: 96%;
            border-radius: 12px;
            margin: 20px auto;
            padding: 12px;
            min-height: 90vh;
        }
        .case-container{
            display: flex;
            justify-content: space-between;
            margin-top: 32px;
        }
        .title{
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
        }

        .case-item{
            width: 45%;
            margin: 0 auto ;
        }

        .sensor-table {
          border-collapse: collapse;
          width: 100%;
          font-size: 14px;
        }

        .sensor-table th,
        .sensor-table td {
            border: 1px solid #ccc;
            padding: 8px;
            width: 118px;
            text-align: center;
        }

        .sensor-table thead th {
              background-color: #e0e0e0;
        }
        .sensor-table tr th:nth-child(1),
        .sensor-table tr th:nth-child(4),
        .sensor-table tr td:nth-child(1),
        .sensor-table tr td:nth-child(4){
            border-right: 1px solid #000000;
        }
    </style>
</head>

<body>



<div class="deatil-container">
    <div class="message-box">
        <div>
            <span class="btn j_users">状态</span>
            <span class="btn j_refresh">刷新</span>
            <span id="message" class="message"></span>
        </div>
        <div class="btn j_reset">重置</div>
    </div>

<!--    <div>-->
<!--        <span class="j_name"></span>-->
<!--    </div>-->
        <div class="case-container">
            <div class="case-item">
                <div class="title">土壤湿度传感器</div>
                <table class="sensor-table">
                    <thead>
                    <tr>
                        <th></th>
                        <th colspan="3" style="border-right: 1px solid #000000;">电压表数值(V)</th>
                        <th colspan="3">实验板数值</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th>干燥</th>
                        <th>一点水</th>
                        <th>多点水</th>
                        <th>干燥</th>
                        <th>一点水</th>
                        <th>多点水</th>
                    </tr>
                    </thead>
                    <tbody class="j_item01">
                    <!--                <tr>-->
                    <!--                    <td>A3</td>-->
                    <!--                    <td>12</td>-->
                    <!--                    <td>15</td>-->
                    <!--                    <td>17</td>-->
                    <!--                    <td>222</td>-->
                    <!--                    <td>333</td>-->
                    <!--                    <td>444</td>-->
                    <!--                </tr>-->



                    </tbody>
                </table>


            </div>
            <div class="case-item">
                <div class="title">光敏传感器</div>
                <table class="sensor-table">
                    <thead>
                    <tr>
                        <th></th>
                        <th colspan="3" style="border-right: 1px solid #000000;">电压表数值(V)</th>
                        <th colspan="3">实验板数值</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th>黑暗</th>
                        <th>亮</th>
                        <th>较亮</th>
                        <th>黑暗</th>
                        <th>亮</th>
                        <th>较亮</th>
                    </tr>
                    </thead>
                    <tbody class="j_item02">
                    <!--                <tr>-->
                    <!--                    <td>A3</td>-->
                    <!--                    <td>12</td>-->
                    <!--                    <td>15</td>-->
                    <!--                    <td>17</td>-->
                    <!--                    <td>222</td>-->
                    <!--                    <td>333</td>-->
                    <!--                    <td>444</td>-->
                    <!--                </tr>-->



                    </tbody>
                </table>


            </div>
        </div>

        <div class="case-container">
            <div class="case-item">
                <div class="title">声音传感器</div>
                <table class="sensor-table">
                    <thead>
                    <tr>
                        <th></th>
                        <th colspan="3" style="border-right: 1px solid #000000;">电压表数值(V)</th>
                        <th colspan="3">实验板数值</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th>安静</th>
                        <th>小声讲话</th>
                        <th>大声讲话</th>
                        <th>安静</th>
                        <th>小声讲话</th>
                        <th>大声讲话</th>
                    </tr>
                    </thead>
                    <tbody class="j_item03">
                    <!--                <tr>-->
                    <!--                    <td>A3</td>-->
                    <!--                    <td>12</td>-->
                    <!--                    <td>15</td>-->
                    <!--                    <td>17</td>-->
                    <!--                    <td>222</td>-->
                    <!--                    <td>333</td>-->
                    <!--                    <td>444</td>-->
                    <!--                </tr>-->

                    </tbody>
                </table>


            </div>
            <div class="case-item">
                <div class="title">温湿度传感器</div>
                <table class="sensor-table">
                    <thead>
                    <tr>
                        <th></th>
                        <th colspan="3" style="border-right: 1px solid #000000;">电压表数值(V)</th>
                        <th colspan="3">实验板数值</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th>降温</th>
                        <th>常温</th>
                        <th>加热</th>
                        <th>降温</th>
                        <th>常温</th>
                        <th>加热</th>
                    </tr>
                    </thead>
                    <tbody class="j_item04">

                    </tbody>
                </table>


            </div>
        </div>

</div>

<script>

const Report = {
    initData:function(){
        let key = sessionStorage.getItem("key");
        if(!key){
            location.href = "./login.html";
        }
        Report.initRecord()
    },
    initEvent:function(){

        $(".j_reset").on('click',function(){
            Report.resetReport();
        })

        $(".j_refresh").on('click',function(){
            Report.initRecord();
        })

        $(".j_users").on('click',function(){
            location.href = "./users.html"
        })
    },

    initRecord:function (){
        $.ajax({
            url: '/lesson/reports',
            method: 'GET',
            contentType: 'application/json',
            dataType: 'json',
            success: function (response) {
                if (response.status === 'success') {
                    $('#message').text('已刷新！');
                    Report.resetTips();
                    Report.recordViews(response.data);

                } else {
                    $('#message').text(response.message)
                }
            },
            error: function (error) {
                $('#message').text('请求出错：' + error.statusText);
            }
        });
    },
    recordViews:function(data){


        data.forEach(function(item){
            let _html = '';
            _html = _html + '<tr>';
            _html = _html +'<td>' + item.seatNumber +'</td>' +'<td>' + item.vol1 +'</td>' +'<td>' + item.vol2 +'</td>'  +'<td>' + item.vol3 +'</td>'
            _html = _html +'<td>' + item.val1 +'</td>' +'<td>' + item.val2 +'</td>'  +'<td>' + item.val3 +'</td>'
            _html = _html + '</tr>'

            if(item.sensor == "01"){
                $(".j_item01").append(_html);
            }

            if(item.sensor == "02"){
                $(".j_item02").append(_html);
            }

            if(item.sensor == "03"){
                $(".j_item03").append(_html);
            }

            if(item.sensor == "04"){
                $(".j_item04").append(_html);
            }

        })




    },

    resetReport:function (){
        $.ajax({
            url: '/lesson/reports/init',
            method: 'POST',
            contentType: 'application/json',
            dataType: 'json',
            success: function (response) {
                if (response.status === 'success') {
                    $('#message').text('重置成功！');
                } else {
                    $('#message').text('重置失败！');
                }
            },
            error: function (error) {
                $('#message').text('请求出错：' + error.statusText);
            }
        });
    },

    resetTips:function(){
        setTimeout(function(){
            $('#message').text('');
        },5000)
    },


    init:function(){
        Report.initData();
        Report.initEvent();
    }
}

$(document).ready(function () {

    Report.init()

});
</script>
</body>

</html>
